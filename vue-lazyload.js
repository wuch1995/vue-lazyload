!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):(e=e||self).VueLazyload=n()}(this,function(){"use strict";var s=function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")};function i(e,n){for(var t=0;t<n.length;t++){var i=n[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var e=function(e,n,t){return n&&i(e.prototype,n),t&&i(e,t),e},r=function(){function a(e){var n=e.src,t=e.el,i=e.defaultSrc;s(this,a),this.src=n,this.el=t,this.default=i,this.status="loading",this.render("loading")}return e(a,[{key:"getRect",value:function(){return this.el.getBoundingClientRect()}},{key:"checkInView",value:function(){var e=this.getRect();return window.innerHeight>e.top&&0<e.bottom&&window.innerWidth>e.left&&0<e.right}},{key:"load",value:function(e){var n,t,i,a,r=this;n=this.src,t=function(e){r.status="loaded",r.render("loaded")},i=function(e){r.status="error",r.render("error"),console.log("".concat(r.src," falid"))},(a=new Image).src=n,a.onload=function(){t(n)},a.onerror=function(e){i(e)}}},{key:"render",value:function(e){var n;switch(e){case"loading":case"error":n=this.default;break;case"loaded":n=this.src}this.el.setAttribute("src",n)}}]),a}();function l(e,n){if(e.length)return e.find(n)}function a(e,n){if(e.length){var t=e.indexOf(n);return-1<t?e.splice(t,1):void 0}}function o(u){return function(){function n(e){var a,r,o,u;s(this,n),this.listenerList=[],this.handleImageLoad=(a=this.handleImageLoad.bind(this),r=300,o=0,u=null,function(){var e=Date.now();if(!u){var n=this,t=arguments;r<=e-o?i():u=setTimeout(i,r)}function i(){a.apply(n,t),u=null,o=Date.now()}}),this.initEvent()}return e(n,[{key:"initEvent",value:function(){window.addEventListener("scroll",this.handleImageLoad)}},{key:"add",value:function(e,n,t){var i=this,a=new r({el:e,src:n.value,defaultSrc:"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"});this.listenerList.push(a),u.nextTick(function(){i.handleImageLoad()})}},{key:"update",value:function(n,e,t,i){var a=this;if(n){var r=e.value,o=l(this.listenerList,function(e){return n===e.el});o&&o.src!==r&&o.update(r),u.nextTick(function(){a.handleImageLoad()})}}},{key:"remove",value:function(n){if(n){var e=l(this.listenerList,function(e){return e.el===n});e&&(a(this.listenerList,e),e=null)}}},{key:"handleImageLoad",value:function(){for(var n=this,e=[],t=this.listenerList.length;t--;){var i=this.listenerList[t];if("loaded"===i.status){e.push(i);break}i.checkInView()&&i.load()}e.length&&e.forEach(function(e){return a(n.listenerList,e)})}}]),n}()}return{install:function(e){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},t=new new o(e)(n);e.directive("lazy",{bind:t.add.bind(t),update:t.update.bind(t),componentUpdated:t.handleImageLoad.bind(t),unbind:t.remove.bind(t)})}}});
